[tox]
envlist = py38, py39, py310
isolated_build = True
skipsdist = False

[testenv]
deps =
    pytest>=6.0
    pytest-cov
    pytest-benchmark
    pytest-xdist
    pytest-randomly
    coverage
    mypy
    black
    flake8
    pylint
    types-requests
    types-PyYAML
    types-setuptools

commands =
    # Run static type checking
    mypy src tests

    # Run style checks
    black --check src tests
    flake8 src tests
    pylint src tests

    # Run tests with coverage
    pytest \
        --verbose \
        --cov=src \
        --cov-report=term-missing \
        --cov-report=html \
        --cov-fail-under=90 \
        --benchmark-only \
        {posargs:tests}

[flake8]
max-line-length = 100
exclude = .tox,*.egg,build,data
ignore = E203, W503

[mypy]
python_version = 3.8
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = True
disallow_incomplete_defs = True
check_untyped_defs = True
disallow_untyped_decorators = True
no_implicit_optional = True
warn_redundant_casts = True
warn_unused_ignores = True
warn_no_return = True
warn_unreachable = True

[mypy-pytest.*]
ignore_missing_imports = True

[pylint]
max-line-length = 100
disable = C0111,R0903,C0103
ignore = migrations,tests
ignore-patterns = test_.*?py

[coverage:run]
source = src
omit = tests/*,setup.py

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    if self.debug:
    raise NotImplementedError
    if __name__ == .__main__.:
    pass

[coverage:html]
directory = coverage_html